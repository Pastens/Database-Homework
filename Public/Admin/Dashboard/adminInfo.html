<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <title>更改资料 —— Eshop</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Static/semantic/semantic/dist/semantic.min.css">
    <script type="text/javascript" src="__PUBLIC__/Static/jquery.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Static/jquery.tablesort.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Static/semantic/semantic/dist/semantic.min.js"></script>
    <style>
    body {
        background-color: #FFFFFF;
    }
    
    .ui.menu .item img.logo {
        margin-right: 1.5em;
    }
    
    .wireframe {
        margin-top: 2em;
    }
    
    body > .ui.grid.container {
        padding-top: 100px !important;
        padding-bottom: 100px !important;
    }
    
    .ui.footer.segment {
        position: fixed;
        bottom: 0;
        width: 100%;
        padding: 2em 0em;
    }
    
    .three.wide.column.statistic {
        margin: 0;
    }
    
    .ui.icon.header {
        margin: 0;
    }
    
    .ui.horizontal.segments>.segment {
        flex: 1 1 100%;
    }
    
    .ui.horizontal.segments>.ui.statistic.segment {
        margin: 0;
    }
    
    .ui.horizontal.segments>.segment .ui.icon.header .content {
        padding: 0;
    }
    
    tr {
        white-space: nowrap;
    }
    
    .ui.animated.fade.green.button {
        margin: 100px;
    }
    .ui.center.aligned.grid{
        margin: 10px;
    }

    </style>
</head>

<body>
    <div class="ui fixed inverted menu">
        <div class="ui container">
            <a href="{:U('Admin/dashboard/index')}" class="header item">
                <img class="logo" src="__PUBLIC__/Static/assets/images/logo.png">管理面板
            </a>
            <a href="{:U('Admin/dashboard/index')}" class="item">面板首页</a>
            <switch name="data.adminSuperior">
                <case value="0|1">
                    <div class="ui simple dropdown item">
                        商店管理 <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item" href="{:U('Admin/dashboard/itemCatalog')}">商品概况</a>
                            <a class="item" href="{:U('Admin/dashboard/shopList')}">店铺管理</a>
                            <a class="item" href="{:U('Admin/dashboard/itemList')}">商品管理</a>
                            <div class="divider"></div>
                            <a class="item" href="{:U('Admin/dashboard/orderList')}">订单管理</a>
                        </div>
                    </div>
                    <div class="ui simple dropdown item">用户管理 <i class="dropdown icon"></i>
                        <div class="menu"><a class="item" href="{:U('Admin/dashboard/userManage')}">会员管理</a><a class="item" href="{:U('Admin/dashboard/adminManage')}">管理员管理</a></div>
                    </div>
                    <div class="ui simple dropdown item">
                        系统管理 <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item" href="{:U('Admin/dashboard/systemLog')}">系统日志</a>
                            <div class="divider"></div>
                            <a class="item" href="{:U('Admin/dashboard/apiList')}">API列表</a>
                            <a class="item" href="{:U('Admin/dashboard/devDocument')}">开发文档</a>
                        </div>
                    </div>
                    <div class="right menu">
                        <div class="ui simple dropdown item">
                            欢迎你，{$data.adminName} <i class="dropdown icon"></i>
                            <div class="menu">
                                <a class="item" href="{:U('Admin/dashboard/adminInfo')}">更改资料</a>
                                <a class="item" href="{:U('Admin/dashboard/resetPassword')}">更改密码</a>
                                <a class="item" href="{:U('Admin/login/logout')}">登出</a>
                            </div>
                        </div>
                    </div>
                </case>
                <case value="2">
                    <div class="ui simple dropdown item">
                        商店管理 <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item" href="{:U('Admin/dashboard/itemCatalog')}">商品概况</a>
                            <a class="item" href="{:U('Admin/dashboard/shopList')}">店铺管理</a>
                            <a class="item" href="{:U('Admin/dashboard/itemList')}">商品管理</a>
                        </div>
                    </div>
                    <div class="right menu">
                        <div class="ui simple dropdown item">
                            欢迎你，{$data.adminName} <i class="dropdown icon"></i>
                            <div class="menu">
                                <a class="item" href="{:U('Admin/dashboard/adminInfo')}">更改资料</a>
                                <a class="item" href="{:U('Admin/dashboard/resetPassword')}">更改密码</a>
                                <a class="item" href="{:U('Admin/login/logout')}">登出</a>
                            </div>
                        </div>
                    </div>
                </case>
                <case value="3">
                    <div class="ui simple dropdown item">
                        商店管理 <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item" href="{:U('Admin/dashboard/itemCatalog')}">商品概况</a>
                            <a class="item" href="{:U('Admin/dashboard/shopList')}">店铺管理</a>
                            <a class="item" href="{:U('Admin/dashboard/itemList')}">商品管理</a>
                            <div class="divider"></div>
                            <a class="item" href="{:U('Admin/dashboard/orderList')}">订单管理</a>
                        </div>
                    </div>
                    <div class="right menu">
                        <div class="ui simple dropdown item">
                            欢迎你，{$data.adminName} <i class="dropdown icon"></i>
                            <div class="menu">
                                <a class="item" href="{:U('Admin/dashboard/adminInfo')}">更改资料</a>
                                <a class="item" href="{:U('Admin/dashboard/resetPassword')}">更改密码</a>
                                <a class="item" href="{:U('Admin/login/logout')}">登出</a>
                            </div>
                        </div>
                    </div>
                </case>
                <case value="4">
                    <div class="ui simple dropdown item">用户管理 <i class="dropdown icon"></i>
                        <div class="menu"><a class="item" href="{:U('Admin/dashboard/userManage')}">会员管理</a><a class="item" href="{:U('Admin/dashboard/adminManage')}">管理员管理</a></div>
                    </div>
                    <div class="right menu">
                        <div class="ui simple dropdown item">
                            欢迎你，{$data.adminName} <i class="dropdown icon"></i>
                            <div class="menu">
                                <a class="item" href="{:U('Admin/dashboard/adminInfo')}">更改资料</a>
                                <a class="item" href="{:U('Admin/dashboard/resetPassword')}">更改密码</a>
                                <a class="item" href="{:U('Admin/login/logout')}">登出</a>
                            </div>
                        </div>
                    </div>
                </case>
                <case value="5">
                    <div class="ui simple dropdown item">
                        商店管理 <i class="dropdown icon"></i>
                        <div class="menu">
                            <a class="item" href="{:U('Admin/dashboard/itemCatalog')}">商品概况</a>
                            <a class="item" href="{:U('Admin/dashboard/shopList')}">店铺管理</a>
                            <a class="item" href="{:U('Admin/dashboard/itemList')}">商品管理</a>
                            <div class="divider"></div>
                            <a class="item" href="{:U('Admin/dashboard/orderList')}">订单管理</a>
                        </div>
                    </div>
                    <div class="right menu">
                        <div class="ui simple dropdown item">
                            欢迎你，{$data.adminName} <i class="dropdown icon"></i>
                            <div class="menu">
                                <a class="item" href="{:U('Admin/dashboard/adminInfo')}">更改商店资料</a>
                                <a class="item" href="{:U('Admin/dashboard/resetPassword')}">更改密码</a>
                                <a class="item" href="{:U('Admin/login/logout')}">登出</a>
                            </div>
                        </div>
                    </div>
                </case>
            </switch>
        </div>
    </div>
    <div class="ui grid container">
        <div class="ui fourteen wide centered column">
            <div class="ui piled segments">
                <div class="ui segment">
                    <div class="ui breadcrumb">
                        <a class="section" href="{:U('Admin/dashboard/index')}">管理面板</a>
                        <i class="right arrow icon divider"></i>
                        <div class="active section">更改资料</div>
                    </div>
                </div>
                <div class="ui segment">
                    <div class="ui center aligned grid">
                        <div class="ui form">
                            <div class="field">
                                <label>原用户名</label>
                                <input rows="1" type="text" name="userName" id="mark" value="{$data.adminName}" disabled>
                            </div>
                            <div class="field">
                                <label>新用户名</label>
                                <input rows="1" type="text" id="userName" placeholder="请输入新的用户名">
                            </div>
                            <div class="ui error message"></div>
                            <div class="ui success message"></div>
                        </div>
                        <div class="row">
                            <div class="ui animated fade red button">
                                <div class="visible content">
                                    <i class="warning icon"></i> 修改用户名
                                </div>
                                <div class="hidden content">
                                    <i class="checkmark box icon"></i> 确认修改
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui inverted vertical footer segment">
        <div class="ui center aligned container">
            <div class="ui horizontal inverted small divided link list">
                <a class="item" href="#">Copyright &copy; Eshop.</a>
                <a class="item" href="http://www.liuhc.cn">Powered By Haocheng Liu</a>
            </div>
        </div>
    </div>
    <script>
    jQuery(document).ready(function($) {
        $('.ui.form').on('click',  function(event) {
            $(this).removeClass('error');
            $(this).removeClass('success');
        });

        $('.ui.animated.fade.red.button').on('click', function(event) {
            var userName = $("#userName").val();

            if(userName == null || userName == ""){
                var message = "<p>"+"请输入要更改的用户名"+"</p>";
                $('.ui.error.message').html(message);
                $('.ui.form').addClass('error');
            }else if(userName == $('#mark').val()){
                var message = "<p>"+"更改的用户名与原用户名相同"+"</p>";
                $('.ui.error.message').html(message);
                $('.ui.form').addClass('error');
            }else{
                $.ajax({
                    url: '{:U("Admin/User/resetAdminname")}',
                    type: 'POST',
                    dataType: 'json',
                    data: {adminName: userName},
                    success: function(data){
                        if(data.status == 1){
                            var message = "<p>"+"修改成功, 3秒后重新登录"+"</p>";
                            $('.ui.success.message').html(message);
                            $('.ui.form').addClass('success');
                            var t = setTimeout(function(){
                                location.href = "{:U('Admin/Login/logout')}";
                            },3000);
                        }else if(data.status == 0){
                            var message = "<p>"+data.info+"</p>";
                            $('.ui.error.message').html(message);
                            $('.ui.form').addClass('error');
                        }
                    }
                })
                .done(function() {
                    console.log("success");
                })
                .fail(function() {
                    console.log("error");
                })
                .always(function() {
                    console.log("complete");
                });
                
            }

        });
    });
    </script>
</body>

</html>
